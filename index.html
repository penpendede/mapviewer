<html>
<head>
    <title>Kartenanzeiger</title>
    <link rel="stylesheet" href="leaflet/leaflet.css"/>
    <script src="leaflet/leaflet.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        html, body, #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
  let map = L.map('map')
  let currentBaseLayer
  let currentFeatureLayer = []
  let {ipcRenderer} = require('electron')

  setBaseLayer = (source) => {
    if (currentBaseLayer) {
      currentBaseLayer.removeFrom(map)
    }
    currentBaseLayer = L.tileLayer(source.uriTemplate, source.opts)
    currentBaseLayer.addTo(map)
  }

  toggleFeatureLayer = (source) => {
    if (currentFeatureLayer[source.uriTemplate]) {
      currentFeatureLayer[source.uriTemplate].removeFrom(map)
      currentFeatureLayer[source.uriTemplate] = null
    } else {
      currentFeatureLayer[source.uriTemplate] = L.tileLayer(source.uriTemplate, source.opts)
      currentFeatureLayer[source.uriTemplate].addTo(map)
    }
  }

  ipcRenderer.on('set-base-layer', (event, arg) => {
    setBaseLayer(arg)
  })

  ipcRenderer.on('toggle-feature-layer', (event, arg) => {
    toggleFeatureLayer(arg)
  })

  map.setView([50.733992, 7.099814], 13)
  setBaseLayer({'uriTemplate': 'nothing.png', 'opt': {}})
</script>
</body>
</html>
